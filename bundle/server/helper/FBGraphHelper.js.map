{"version":3,"sources":["../../../server/helper/FBGraphHelper.js"],"names":["FBGraphHelper","params","access_token","constant","FB_APP_ACCESS_TOKEN","website_url","HEROKU_APP_URL","logger","info","JSON","stringify","fbrequest","post","uri","GRAPH_BASE_URL","FB_APP_ID","json","then","_body","catch","err","error","stack","page","options","object","callback_url","CALLBACK_URL","fields","verify_token","WEBHOOK_VERIFY_TOKEN","id"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;;;;;IAEqBA,a;;;;;;;oCAEI;AACrB,UAAIC,SAAS;AACXC,sBAAcC,mBAASC,mBADZ;AAEXC,qBAAaF,mBAASG;AAFX,OAAb;AAIAC,uBAAOC,IAAP,6BAAsCL,mBAASG,cAA/C,qBAA6EG,KAAKC,SAAL,CAAeT,MAAf,CAA7E;AACA,aAAOU,oBAAUC,IAAV,CAAe;AACpBC,aAAQV,mBAASW,cAAjB,SAAmCX,mBAASY,SADxB;AAEpBC,cAAMf;AAFc,OAAf,EAINgB,IAJM,CAID,UAACC,KAAD,EAAW;AACfX,yBAAOC,IAAP,CAAY,iBAAZ;AACD,OANM,EAONW,KAPM,CAOA,UAACC,GAAD,EAAS;AACdb,yBAAOc,KAAP,kCAA4CD,GAA5C;AACA,YAAIA,IAAIE,KAAR,EAAe;AACbf,2BAAOc,KAAP,CAAaD,IAAIE,KAAjB;AACD;AACD,eAAOF,GAAP;AACD,OAbM,CAAP;AAcD;;;sCAEwBG,I,EAAM;AAC7B,UAAIC,UAAU;AACZX,aAAQV,mBAASW,cAAjB,SAAmCX,mBAASY,SAA5C,mBADY;AAEZC,cAAM;AACJd,wBAAcC,mBAASC,mBADnB;AAEJqB,kBAAQ,MAFJ;AAGJC,wBAAcvB,mBAASwB,YAHnB;AAIJC,kBAAQ,CAAC,UAAD,EAAa,qBAAb,CAJJ;AAKJC,wBAAc1B,mBAAS2B;AALnB;AAFM,OAAd;AAUAvB,uBAAOC,IAAP,8CAAuDC,KAAKC,SAAL,CAAec,QAAQR,IAAvB,CAAvD;;AAEA,aAAOL,oBAAUC,IAAV,CAAeY,OAAf,EACJP,IADI,CACC,UAACC,KAAD,EAAW;AACfX,yBAAOC,IAAP,CAAY,wCAAZ;AACA,YAAIP,SAAS;AACXC,wBAAcqB,KAAKrB;AADR,SAAb;AAGAK,yBAAOC,IAAP,2CAAoDC,KAAKC,SAAL,CAAeT,MAAf,CAApD;AACA,eAAOU,oBAAUC,IAAV,CAAe;AACpBC,eAAQV,mBAASW,cAAjB,SAAmCS,KAAKQ,EAAxC,qBADoB;AAEpBf,gBAAMf;AAFc,SAAf,CAAP;AAID,OAXI,EAYJgB,IAZI,CAYC,UAACC,KAAD,EAAW;AACfX,yBAAOC,IAAP,CAAY,qCAAZ;AACD,OAdI,EAeJW,KAfI,CAeE,UAACC,GAAD,EAAS;AACdb,yBAAOc,KAAP,wCAAkDZ,KAAKC,SAAL,CAAeU,GAAf,CAAlD;AACA,eAAOA,GAAP;AACD,OAlBI,CAAP;AAmBD;;;;;;kBAxDkBpB,a","file":"FBGraphHelper.js","sourcesContent":["import constant from 'common/constant';\nimport logger from 'common/logger';\nimport fbrequest from 'common/fbrequest';\n\nexport default class FBGraphHelper {\n\n  static setWebsiteURL() {\n    let params = {\n      access_token: constant.FB_APP_ACCESS_TOKEN,\n      website_url: constant.HEROKU_APP_URL,\n    };\n    logger.info(`Setting Website URL to ${constant.HEROKU_APP_URL} with param: ${JSON.stringify(params)}`);\n    return fbrequest.post({\n      uri: `${constant.GRAPH_BASE_URL}/${constant.FB_APP_ID}`,\n      json: params,\n    })\n    .then((_body) => {\n      logger.info('Website URL set');\n    })\n    .catch((err) => {\n      logger.error(`Website URL setting failed: ${err}`);\n      if (err.stack) {\n        logger.error(err.stack);\n      }\n      return err;\n    });\n  }\n\n  static subscribeWebhooks(page) {\n    let options = {\n      uri: `${constant.GRAPH_BASE_URL}/${constant.FB_APP_ID}/subscriptions`,\n      json: {\n        access_token: constant.FB_APP_ACCESS_TOKEN,\n        object: 'page',\n        callback_url: constant.CALLBACK_URL,\n        fields: ['messages', 'messaging_postbacks'],\n        verify_token: constant.WEBHOOK_VERIFY_TOKEN\n      },\n    };\n    logger.info(`Subscribing webhook events with params: ${JSON.stringify(options.json)}`);\n\n    return fbrequest.post(options)\n      .then((_body) => {\n        logger.info('Subscribed webhook events successfully');\n        let params = {\n          access_token: page.access_token,\n        };\n        logger.info(`Subscribing page to app with params: ${JSON.stringify(params)}`);\n        return fbrequest.post({\n          uri: `${constant.GRAPH_BASE_URL}/${page.id}/subscribed_apps`,\n          json: params,\n        });\n      })\n      .then((_body) => {\n        logger.info('Subscribed page to app successfully');\n      })\n      .catch((err) => {\n        logger.error(`Failed to subscribed page to app: ${JSON.stringify(err)}`);\n        return err;\n      });\n  }\n}\n"]}