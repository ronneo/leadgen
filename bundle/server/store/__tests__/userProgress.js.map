{"version":3,"sources":["../../../../server/store/__tests__/userProgress.js"],"names":["jest","mock","REDISCLOUD_URL","LOCAL_FILE_STORE_PATH","beforeAll","fs","ensureDirSync","constant","test","thedh","DataHandler","get","then","dh","getUserProgress","user_progress_mgr","update","expectRespType","nextQid","stopAtQid","expect","readJsonSync","datastore","paths","user_progress","toMatchObject","userProgress","afterAll","removeSync"],"mappings":";;AAAA;;;;AAEA;;;;AACA;;;;;;AAEAA,KAAKC,IAAL,CAAU,iBAAV,EAA6B,YAAM;AACjC,SAAO;AACLC,oBAAgB,EADX;AAELC,2BAAuB;AAFlB,GAAP;AAID,CALD;;AAOAC,UAAU,YAAM;AACdC,oBAAGC,aAAH,CAAiBC,mBAASJ,qBAA1B;AACD,CAFD;;AAIAK,KAAK,KAAL,EAAY,YAAM;AAChB,MAAIC,QAAQ,IAAZ;AACA,SAAOC,sBAAYC,GAAZ,GACJC,IADI,CACC,UAACC,EAAD,EAAQ;AACZJ,YAAQI,EAAR;AACA,WAAOJ,MAAMK,eAAN,CAAsB,CAAtB,CAAP;AACD,GAJI,EAKJF,IALI,CAKC,UAACG,iBAAD,EAAuB;AAC3B,WAAOA,kBAAkBC,MAAlB,CAAyB;AAC9BC,sBAAgB,aADc;AAE9BC,eAAS,CAFqB;AAG9BC,iBAAW;AAHmB,KAAzB,CAAP;AAKD,GAXI,EAYJP,IAZI,CAYC,YAAM;AACVQ,WAAOf,kBAAGgB,YAAH,CACFZ,MAAMa,SAAN,CAAgBC,KAAhB,CAAsBC,aADpB,aAAP,EAGCC,aAHD,CAGe;AACbR,sBAAgB,aADH;AAEbC,eAAS,CAFI;AAGbC,iBAAW;AAHE,KAHf;AAQA,WAAOV,MAAMK,eAAN,CAAsB,CAAtB,CAAP;AACD,GAtBI,EAuBJF,IAvBI,CAuBC,UAACG,iBAAD,EAAuB;AAC3BK,WAAOL,kBAAkBW,YAAzB,EAAuCD,aAAvC,CAAqD;AACnDR,sBAAgB,aADmC;AAEnDC,eAAS,CAF0C;AAGnDC,iBAAW;AAHwC,KAArD;AAKD,GA7BI,CAAP;AA8BD,CAhCD;;AAkCAQ,SAAS,YAAM;AACbtB,oBAAGuB,UAAH,CAAcrB,mBAASJ,qBAAvB;AACD,CAFD","file":"userProgress.js","sourcesContent":["import fs from 'fs-extra';\n\nimport constant from 'common/constant';\nimport DataHandler from 'server/store/DataHandler';\n\njest.mock('common/constant', () => {\n  return {\n    REDISCLOUD_URL: '',\n    LOCAL_FILE_STORE_PATH: './var/data_test_user_progress',\n  };\n});\n\nbeforeAll(() => {\n  fs.ensureDirSync(constant.LOCAL_FILE_STORE_PATH);\n});\n\ntest('all', () => {\n  let thedh = null;\n  return DataHandler.get()\n    .then((dh) => {\n      thedh = dh;\n      return thedh.getUserProgress(4);\n    })\n    .then((user_progress_mgr) => {\n      return user_progress_mgr.update({\n        expectRespType: 'quick_reply',\n        nextQid: 2,\n        stopAtQid: 1,\n      });\n    })\n    .then(() => {\n      expect(fs.readJsonSync(\n        `${thedh.datastore.paths.user_progress}_4.json`,\n      ))\n      .toMatchObject({\n        expectRespType: 'quick_reply',\n        nextQid: 2,\n        stopAtQid: 1,\n      });\n      return thedh.getUserProgress(4);\n    })\n    .then((user_progress_mgr) => {\n      expect(user_progress_mgr.userProgress).toMatchObject({\n        expectRespType: 'quick_reply',\n        nextQid: 2,\n        stopAtQid: 1,\n      });\n    });\n});\n\nafterAll(() => {\n  fs.removeSync(constant.LOCAL_FILE_STORE_PATH);\n});\n"]}