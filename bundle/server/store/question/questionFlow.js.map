{"version":3,"sources":["../../../../server/store/question/questionFlow.js"],"names":["DEFAULT_QUESTION_FLOW_KEY","QuestionFlow","datahandler","datastore","key","questions","Promise","resolve","_reject","_read","paths","question_flow","then","data","JSON","parse","catch","err","logger","error","stringify","info","_write","anchor","length","findIndex","question","qid","questionID","next","findQidWithAnchor","payload","option","options","find","resp_payload","nextQid","elements","forEach","element","buttons","button","url"],"mappings":"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","file":"questionFlow.js","sourcesContent":["import logger from 'common/logger';\n\nconst DEFAULT_QUESTION_FLOW_KEY = 'default';\n\nexport default class QuestionFlow {\n  constructor(datahandler) {\n    this.datastore = datahandler.datastore;\n    this.key = null;\n    this.questions = [];\n  }\n\n  load(key = DEFAULT_QUESTION_FLOW_KEY) {\n    this.key = key;\n    return new Promise((resolve, _reject) => {\n      this.datastore._read(this.datastore.paths.question_flow, key)\n        .then((data) => {\n          this.questions = JSON.parse(data);\n          this.questions = [\n  {\n    \"type\": \"greeting\",\n    \"text\": \" Hi, {{recipient.first_name}}! I’m stoked you’re interested to learn about Seafront Residences in San Juan, Batangas. \"\n  },\n  {\n    \"type\": \"question\",\n    \"text\": \"Where do you want to start?\",\n    \"options\": [\n      {\n        \"text\": \"Beach homes\",\n        \"resp_payload\": \"beach_home\",\n        \"next\": \"#beachhomes\"\n      },\n      {\n        \"text\": \"Location map\",\n        \"resp_payload\": \"location\",\n        \"next\": \"#locationmap\"\n      },\n      {\n        \"text\": \"Seaside amenities\",\n        \"resp_payload\": \"amenities\",\n        \"next\": \"#amenities\"\n      }\n    ]\n  },\n  {\n    \"type\": \"image\",\n    \"url\": \"http://www.ronneo.com/store/wp-content/uploads/2018/06/beanie-768x768.jpg\",\n    \"anchor\": \"#locationmap\"\n  },\n  {\n    \"type\": \"question\",\n    \"text\": \"Let me show you around! What do you want to see?\",\n    \"options\": [\n      {\n        \"text\": \"Beach homes\",\n        \"resp_payload\": \"beach_home\",\n        \"next\": \"#beachhomes\"\n      },\n      {\n        \"text\": \"Seaside amenities\",\n        \"resp_payload\": \"amenities\",\n        \"next\": \"#amenities\"\n      }\n    ]\n  },\n  {\n    \"type\": \"carousel\",\n    \"elements\": [\n      {\n        \"title\": \"4 Bedrooms\",\n        \"subtitle\": \"Two-storey unit, 4 baths\",\n        \"image_url\": \"http://www.ronneo.com/aboitiz/4bedroom_screen.jpg\",\n        \"url\": \"\",\n        \"buttons\": [\n          {\n            \"title\": \"View Details\",\n            \"url\": \"view4bed\",\n            \"next\": \"#4bedroom\"\n          }\n        ]\n      },\n      {\n        \"title\": \"3 Bedrooms\",\n        \"subtitle\": \"Two-storey unit, 2 baths and 1 powder room\",\n        \"image_url\": \"http://www.ronneo.com/aboitiz/3bedroom_screen.jpg\",\n        \"url\": \"\",\n        \"buttons\": [\n          {\n            \"title\": \"View Details\",\n            \"url\": \"view3bed\",\n            \"next\": \"#3bedroom\"\n          }\n        ]\n      },\n      {\n        \"title\": \"Lot\",\n        \"subtitle\": \"\",\n        \"image_url\": \"http://www.ronneo.com/aboitiz/lot.jpg\",\n        \"url\": \"\",\n        \"buttons\": [\n          {\n            \"title\": \"View Details\",\n            \"url\": \"viewlot\",\n            \"next\": \"#lot\"\n          }\n        ]\n      }\n    ],\n    \"anchor\": \"#beachhomes\"\n  },\n  {\n    \"type\": \"image\",\n    \"url\": \"http://www.ronneo.com/aboitiz/4bedroom.jpg\",\n    \"anchor\": \"#4bedroom\",\n    \"next\": \"#4bedroom_details\"\n  },\n  {\n    \"type\": \"greeting\",\n    \"text\": \"•\\tLot area: 237 sqm (approx.)\\n•\\tFloor area: 150 sqm \\n•\\tTwo-storey unit\\n•\\tAzotea (accessible roof deck)\\n•\\t4 baths\\n•\\tMaid’s room with toilet\\n•\\tCarpark for 2 vehicles\\n\\nPrice range: Php 11.5M - 12M (VAT inclusive)\",\n    \"next\": \"#afterunit\",\n    \"anchor\": \"#4bedroom_details\"\n  },\n  {\n    \"type\": \"image\",\n    \"url\": \"http://www.ronneo.com/aboitiz/3bedroom.jpg\",\n    \"anchor\": \"#3bedroom\",\n    \"next\": \"#3bedroom_details\"\n  },\n  {\n    \"type\": \"greeting\",\n    \"text\": \"•\\tLot area: 200 sqm (approx.)\\n•\\tFloor area: 100 sqm \\n•\\tTwo-storey unit\\n•\\tAzotea (accessible roof deck)\\n•\\t2 baths and 1 powder room\\n•\\tMaid’s room with toilet\\n•\\tCarpark for 2 vehicles\\n\\nPrice range: Php 8.5M - 9M (VAT inclusive)\",\n    \"next\": \"#afterunit\",\n    \"anchor\": \"#3bedroom_details\"\n  },\n  {\n    \"type\": \"image\",\n    \"url\": \"http://www.ronneo.com/aboitiz/lot.jpg\",\n    \"anchor\": \"#lot\",\n    \"next\": \"#lot_details\"\n  },\n  {\n    \"type\": \"greeting\",\n    \"text\": \"•\\tLot area: 200 sqm (approx.)\\n•\\tFloor area: 100 sqm \\n•\\tCarpark for 2 vehicles\\n\\nPrice range: Php XM - XM (VAT inclusive)\",\n    \"anchor\": \"#lot_details\",\n    \"next\": \"#afterunit\"\n  },\n  {\n    \"type\": \"question\",\n    \"text\": \" Owning a beach house is right at your finger tips! Choose one\",\n    \"options\": [\n      {\n        \"text\": \"Get a sample computation\",\n        \"resp_payload\": \"paymentterms\",\n        \"next\": \"#leadstart\"\n      },\n      {\n        \"text\": \"Schedule a tour\",\n        \"resp_payload\": \"tour\",\n        \"next\": \"#leadstart\"\n      },\n      {\n        \"text\": \"View other units\",\n        \"resp_payload\": \"homeothers\",\n        \"next\": \"#beachhomes\"\n      },\n      {\n        \"text\": \"View seaside amenities\",\n        \"resp_payload\": \"amenities\",\n        \"next\": \"#amenities\"\n      },\n      {\n        \"text\": \"I'm done\",\n        \"resp_payload\": \"thankyou\",\n        \"next\": \"#endconfirmation\"\n      }\n    ],\n    \"anchor\": \"#afterunit\"\n  },\n  {\n    \"type\": \"input\",\n    \"text\": \"Great! Please enter your full name\",\n    \"anchor\": \"#leadstart\",\n    \"next\": \"#lead_email\"\n  },\n  {\n    \"type\": \"input\",\n    \"text\": \"Let us know your email address\",\n    \"quick_replies\": [\n      {\n        \"content_type\": \"user_email\"\n      }\n    ],\n    \"anchor\": \"#lead_email\",\n    \"next\": \"#lead_phone\"\n  },\n  {\n    \"type\": \"input\",\n    \"text\": \"What's your phone number?\",\n    \"quick_replies\": [\n      {\n        \"content_type\": \"user_phone_number\"\n      }\n    ],\n    \"anchor\": \"#lead_phone\",\n    \"next\": \"#lead_terms\"\n  },\n  {\n    \"type\": \"t&c\",\n    \"text\": \"View our data privacy here\",\n    \"url\": \"http://www.starwars.com/news/40-memorable-star-wars-quotes\",\n    \"urlText\": \"View Details\",\n    \"URL\": \"http://www.starwars.com/news/40-memorable-star-wars-quote\",\n    \"anchor\": \"#lead_terms\",\n    \"next\": \"#lead_contact\"\n  },\n  {\n    \"type\": \"question\",\n    \"text\": \"Awesome! How do you want us to get in touch with you?\",\n    \"options\": [\n      {\n        \"text\": \"Phone call\",\n        \"resp_payload\": \"contactphone\",\n        \"next\": \"#leadend\"\n      },\n      {\n        \"text\": \"Email\",\n        \"resp_payload\": \"contactemail\",\n        \"next\": \"#leadend\"\n      }\n    ],\n    \"anchor\": \"#lead_contact\"\n  },\n  {\n    \"type\": \"greeting\",\n    \"text\": \"Thank you, {{recipient.first_name}}! Our sales representative will contact you in 24-48 hours to discuss your Seafront Residences options.\\n\\nHead to the shore and experience beach living at its finest!\",\n    \"anchor\": \"#leadend\",\n    \"next\": \"#endmessage1\"\n  },\n  {\n    \"type\": \"carousel\",\n    \"elements\": [\n      {\n        \"title\": \"Parks\",\n        \"subtitle\": \"Spacious parks to take relaxing strolls in\",\n        \"image_url\": \"http://www.ronneo.com/aboitiz/park.jpg\",\n        \"url\": \"\",\n        \"buttons\": []\n      },\n      {\n        \"title\": \"Multi-purpose Hall\",\n        \"subtitle\": \"A seaside venue for special events and occasions\",\n        \"image_url\": \"http://www.ronneo.com/aboitiz/hall.jpg\",\n        \"url\": \"\",\n        \"buttons\": []\n      },\n      {\n        \"title\": \"Swimming Pool\",\n        \"subtitle\": \"Swim and chill in the beachside pool\",\n        \"image_url\": \"http://www.ronneo.com/aboitiz/pool.jpg\",\n        \"url\": \"\",\n        \"buttons\": []\n      },\n      {\n        \"title\": \"Clubhouse\",\n        \"subtitle\": \"Take lounging to the next level in the comfort of the clubhouse\",\n        \"image_url\": \"http://www.ronneo.com/aboitiz/clubhouse.jpg\",\n        \"url\": \"\",\n        \"buttons\": []\n      }\n    ],\n    \"anchor\": \"#amenities\",\n    \"next\": \"#amenities_next\"\n  },\n  {\n    \"type\": \"question\",\n    \"text\": \" Do you want to check out our beach homes?\",\n    \"options\": [\n      {\n        \"text\": \"Yes, let’s go!\",\n        \"resp_payload\": \"beach_home\",\n        \"next\": \"#beachhomes\"\n      },\n      {\n        \"text\": \"Nah! I’m good.\",\n        \"resp_payload\": \"confirmation\",\n        \"next\": \"#endconfirmation\"\n      }\n    ],\n    \"anchor\": \"#amenities_next\"\n  },\n  {\n    \"type\": \"carousel\",\n    \"elements\": [\n      {\n        \"title\": \" Are you sure you want to end our chat?\",\n        \"subtitle\": \"It’s awesome living by the beach! Wake up to the sun, sea, and sand. Leisure living at its finest!\",\n        \"image_url\": \"http://www.ronneo.com/aboitiz/clubhouse.jpg\",\n        \"url\": \"\",\n        \"buttons\": [\n          {\n            \"title\": \"Yup, I’m done\",\n            \"url\": \"confirmdone\",\n            \"next\": \"#endmessage1\"\n          },\n          {\n            \"title\": \"Ok, show me more\",\n            \"url\": \"confirmmore\",\n            \"next\": \"#beachhomes\"\n          }\n        ]\n      }\n    ],\n    \"anchor\": \"#endconfirmation\"\n  },\n  {\n    \"type\": \"greeting\",\n    \"text\": \"If you have any queries, send us a message at aboitizland@aboitiz.com or visit www.aboitizland.com.\\n\\nIn the meantime, you can view our other residential developments.\\nhttp://www.foressa.com/\\nhttp://ajoyacabanatuan.com.ph/\\nhttp://www.amoacebu.com/\",\n    \"anchor\": \"#endmessage1\"\n  }\n];\n          resolve(this);\n        })\n        .catch((err) => {\n          logger.error(`load question flow ${key} failed with ${JSON.stringify(err)}`);\n          logger.info(`create new question flow ${key}`);\n          this.questions = [];\n          resolve(this);\n        });\n    });\n  }\n\n  save(key = DEFAULT_QUESTION_FLOW_KEY) {\n    this.key = key;\n    return this.datastore._write(\n      this.datastore.paths.question_flow,\n      key,\n      JSON.stringify(this.questions),\n    )\n    .then(() => {\n      logger.info(`question flow ${key} saved.`);\n      return this;\n    })\n    .catch((err) => {\n      logger.error(`save question flow ${key} failed with ${JSON.stringify(err)}`);\n      return err;\n    });\n  }\n\n  findQidWithAnchor(anchor) {\n    if (anchor == '#end') {\n      return this.questions.length;\n    } else {\n      return this.questions.findIndex((question) => {\n        return question.anchor && question.anchor == anchor;\n      });\n    }\n  }\n\n  findQuestionWithQid(qid) {\n    if (qid >= 0 && qid < this.questions.length) {\n      return this.questions[qid];\n    } else {\n      return null;\n    }\n  }\n\n  findNextQidOfQuestion(question, questionID) {\n    if (question.next) {\n      return this.findQidWithAnchor(question.next);\n    } else {\n      return questionID + 1;\n    }\n  }\n\n  findNextQidOfQuestionInOptions(question, questionID, payload) {\n    let option = question.options.find((option) => {\n      return option.resp_payload == payload;\n    });\n    if (option && option.next) {\n      return this.findQidWithAnchor(option.next);\n    } else {\n      return questionID + 1;\n    }\n  }\n\n  findNextQidOfQuestionInElements(question, questionID, payload) {\n    var nextQid = null;\n\n    question.elements.forEach((element) => {\n      if (nextQid) {\n        return;\n      }\n\n      if (element.buttons) {\n        let button = element.buttons.find((button) => {\n          return button.url == payload;\n        });\n\n        if (button && button.next) {\n          nextQid = this.findQidWithAnchor(button.next);\n        }\n      }\n    });\n\n    if (nextQid) {\n      return nextQid;\n    } else {\n      return questionID + 1;\n    }\n  }\n}\n"]}