{"version":3,"sources":["../../../server/devEndpoint/lead.js"],"names":["init","app","dh","get","req","res","scanUserResponses","then","keys","status","send","Promise","all","getUserResponse","query","key","getUserProgress","user_resp_mgr","user_prog_mgr","progress","userProgress","response","userResponses","post","body","save","user_progress_mgr","sendStatus","delete","del"],"mappings":";;;;;;;;QAAgBA,I,GAAAA,I;AAAT,SAASA,IAAT,CAAcC,GAAd,EAAmBC,EAAnB,EAAuB;AAC5BD,MAAIE,GAAJ,CAAQ,qBAAR,EAA+B,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC3CH,OAAGI,iBAAH,GACGC,IADH,CACQ,UAACC,IAAD,EAAU;AACdH,UAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,IAArB;AACD,KAHH;AAID,GALD;;AAOAP,MAAIE,GAAJ,CAAQ,oBAAR,EAA8B,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC1CM,YAAQC,GAAR,CAAY,CACVV,GAAGW,eAAH,CAAmBT,IAAIU,KAAJ,CAAUC,GAA7B,CADU,EAEVb,GAAGc,eAAH,CAAmBZ,IAAIU,KAAJ,CAAUC,GAA7B,CAFU,CAAZ,EAICR,IAJD,CAIM,gBAAoC;AAAA;AAAA,UAAlCU,aAAkC;AAAA,UAAnBC,aAAmB;;AACxCb,UAAII,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBS,kBAAUD,cAAcE,YADL;AAEnBC,kBAAUJ,cAAcK;AAFL,OAArB;AAID,KATD;AAUD,GAXD;;AAaArB,MAAIsB,IAAJ,CAAS,oBAAT,EAA+B,UAACnB,GAAD,EAAMC,GAAN,EAAc;AAAA,oBAChBD,IAAIoB,IADY;AAAA,QACtCL,QADsC,aACtCA,QADsC;AAAA,QAC5BE,QAD4B,aAC5BA,QAD4B;;AAE3CnB,OAAGW,eAAH,CAAmBT,IAAIU,KAAJ,CAAUC,GAA7B,EACGR,IADH,CACQ,UAACU,aAAD,EAAmB;AACvBA,oBAAcK,aAAd,GAA8BD,QAA9B;AACA,aAAOJ,cAAcQ,IAAd,EAAP;AACD,KAJH,EAKGlB,IALH,CAKQ,YAAM;AACV,aAAOL,GAAGc,eAAH,CAAmBZ,IAAIU,KAAJ,CAAUC,GAA7B,CAAP;AACD,KAPH,EAQGR,IARH,CAQQ,UAACmB,iBAAD,EAAuB;AAC3BA,wBAAkBN,YAAlB,GAAiCD,QAAjC;AACA,aAAOO,kBAAkBD,IAAlB,EAAP;AACD,KAXH,EAYGlB,IAZH,CAYQ,YAAM;AACVF,UAAIsB,UAAJ,CAAe,GAAf;AACD,KAdH;AAeD,GAjBD;;AAmBA1B,MAAI2B,MAAJ,CAAW,oBAAX,EAAiC,UAACxB,GAAD,EAAMC,GAAN,EAAc;AAC7CH,OAAGW,eAAH,CAAmBT,IAAIU,KAAJ,CAAUC,GAA7B,EACGR,IADH,CACQ,UAACU,aAAD,EAAmB;AACvB,aAAOA,cAAcY,GAAd,EAAP;AACD,KAHH,EAIGtB,IAJH,CAIQ,YAAM;AACV,aAAOL,GAAGc,eAAH,CAAmBZ,IAAIU,KAAJ,CAAUC,GAA7B,CAAP;AACD,KANH,EAOGR,IAPH,CAOQ,UAACmB,iBAAD,EAAuB;AAC3B,aAAOA,kBAAkBG,GAAlB,EAAP;AACD,KATH,EAUGtB,IAVH,CAUQ,YAAM;AACVF,UAAIsB,UAAJ,CAAe,GAAf;AACD,KAZH;AAaD,GAdD;AAeD","file":"lead.js","sourcesContent":["export function init(app, dh) {\n  app.get('/dev/lead_scan_keys', (req, res) => {\n    dh.scanUserResponses()\n      .then((keys) => {\n        res.status(200).send(keys);\n      });\n  });\n\n  app.get('/dev/lead_with_key', (req, res) => {\n    Promise.all([\n      dh.getUserResponse(req.query.key),\n      dh.getUserProgress(req.query.key),\n    ])\n    .then(([user_resp_mgr, user_prog_mgr]) => {\n      res.status(200).send({\n        progress: user_prog_mgr.userProgress,\n        response: user_resp_mgr.userResponses\n      });\n    });\n  });\n\n  app.post('/dev/lead_with_key', (req, res) => {\n    let {progress, response} = req.body;\n    dh.getUserResponse(req.query.key)\n      .then((user_resp_mgr) => {\n        user_resp_mgr.userResponses = response;\n        return user_resp_mgr.save();\n      })\n      .then(() => {\n        return dh.getUserProgress(req.query.key);\n      })\n      .then((user_progress_mgr) => {\n        user_progress_mgr.userProgress = progress;\n        return user_progress_mgr.save();\n      })\n      .then(() => {\n        res.sendStatus(200);\n      });\n  });\n\n  app.delete('/dev/lead_with_key', (req, res) => {\n    dh.getUserResponse(req.query.key)\n      .then((user_resp_mgr) => {\n        return user_resp_mgr.del();\n      })\n      .then(() => {\n        return dh.getUserProgress(req.query.key);\n      })\n      .then((user_progress_mgr) => {\n        return user_progress_mgr.del();\n      })\n      .then(() => {\n        res.sendStatus(200);\n      });\n  });\n}\n"]}